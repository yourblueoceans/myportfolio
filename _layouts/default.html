<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: 'en' }}">

{%- include head.html -%}

<body class="{% if site.darkmode == true and site.darkmode != 'never' %}dark{% endif %}">

  {%- include header.html -%}

  <main class="page-content" aria-label="Content">
    <div class="wrapper">

      {%- if jekyll.environment == 'production' and site.gtm -%}
        {%- include gtm_body.html -%}
      {%- endif -%}

      {%- include about.html -%}

      {% if site.content %}
        <nav class="section-nav" aria-label="섹션 바로가기">
          {% for section in site.content %}
            <a href="#{{ section.title | slugify }}">{{ section.title }}</a>
          {% endfor %}
        </nav>
      {% endif %}

      {%- if site.version == 2 -%}
        {% for section in site.content %}
          <div class="container {{ section.layout }}-container">
            <h3 id="{{ section.title | slugify }}">{{ section.title }}</h3>
            {% include {{ section.layout | prepend: "section-" | append: ".html" }} content=section.content %}
          </div>
        {% endfor %}
      {% else %}
        {%- include v1/default.html -%}
      {%- endif -%}
    </div>
  </main>

  {%- include footer.html -%}
  {% if site.darkmode == false %}
    <script src="{{ '/assets/js/index.js' | relative_url }}"></script>
  {% endif %}
  <script>
    (function () {
      const links = document.querySelectorAll('.section-nav a');
      if (!('IntersectionObserver' in window) || !links.length) return;

      const map = {};
      links.forEach((link) => {
        const id = link.getAttribute('href').replace('#', '');
        map[id] = link;
      });

      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              const id = entry.target.getAttribute('id');
              links.forEach((l) => l.classList.remove('is-active'));
              if (map[id]) {
                map[id].classList.add('is-active');
              }
            }
          });
        },
        { threshold: 0.45 }
      );

      Object.keys(map).forEach((id) => {
        const section = document.getElementById(id);
        if (section) {
          observer.observe(section);
        }
      });
    })();
  </script>
</body>

</html>
